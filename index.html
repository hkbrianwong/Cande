<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BP Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  label { display: block; margin-top: 10px; }
  input { padding: 5px; margin-top: 3px; width: 100%; }
  button { margin-top: 10px; padding: 8px 12px; }
  table { border-collapse: collapse; width: 100%; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background-color: #f4f4f4; }
  canvas { margin-top: 20px; }
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<h2>Blood Pressure Tracker</h2>

<label>Date & Time:
  <input type="datetime-local" id="datetime">
</label>
<label>Systolic (mmHg):
  <input type="number" id="systolic" inputmode="numeric" pattern="[0-9]*" required>
</label>
<label>Diastolic (mmHg):
  <input type="number" id="diastolic" inputmode="numeric" pattern="[0-9]*" required>
</label>
<label>Pulse (bpm):
  <input type="number" id="pulse" inputmode="numeric" pattern="[0-9]*" required>
</label>

<button onclick="addReading()">Add Reading</button>
<button onclick="exportCSV()">Export CSV</button>

<canvas id="bpChart"></canvas>

<table id="bpTable">
  <thead>
    <tr>
      <th>Date & Time</th>
      <th>Systolic</th>
      <th>Diastolic</th>
      <th>Pulse</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
let readings = JSON.parse(localStorage.getItem('bpReadings') || '[]');

const ctx = document.getElementById('bpChart').getContext('2d');
let bpChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: readings.map(r => r.datetime),
        datasets: [
            {
                label: 'Systolic (mmHg)',
                data: readings.map(r => r.systolic),
                borderColor: 'orange',
                backgroundColor: 'orange',
                fill: false,
                tension: 0.3
            },
            {
                label: 'Diastolic (mmHg)',
                data: readings.map(r => r.diastolic),
                borderColor: 'gold',
                backgroundColor: 'gold',
                fill: false,
                tension: 0.3
            }
        ]
    },
    options: {
        responsive: true,
        plugins: {
            legend: { position: 'top' },
            title: { display: true, text: 'Blood Pressure Readings' }
        },
        scales: {
            y: {
                title: { display: true, text: 'Blood Pressure (mmHg)' },
                beginAtZero: false
            },
            x: {
                title: { display: true, text: 'Date & Time' }
            }
        }
    }
});

function updateTable() {
    const tbody = document.querySelector('#bpTable tbody');
    tbody.innerHTML = '';
    readings.forEach(r => {
        const row = `<tr>
            <td>${r.datetime}</td>
            <td>${r.systolic}</td>
            <td>${r.diastolic}</td>
            <td>${r.pulse}</td>
        </tr>`;
        tbody.innerHTML += row;
    });
}

function updateChart() {
    bpChart.data.labels = readings.map(r => r.datetime);
    bpChart.data.datasets[0].data = readings.map(r => r.systolic);
    bpChart.data.datasets[1].data = readings.map(r => r.diastolic);
    bpChart.update();
}

function addReading() {
    const datetime = document.getElementById('datetime').value || new Date().toLocaleString();
    const systolic = parseInt(document.getElementById('systolic').value);
    const diastolic = parseInt(document.getElementById('diastolic').value);
    const pulse = parseInt(document.getElementById('pulse').value);
    
    if (!systolic || !diastolic || !pulse) {
        alert('Please enter all values');
        return;
    }
    
    readings.push({ datetime, systolic, diastolic, pulse });
    localStorage.setItem('bpReadings', JSON.stringify(readings));
    updateTable();
    updateChart();

    document.getElementById('systolic').value = '';
    document.getElementById('diastolic').value = '';
    document.getElementById('pulse').value = '';
}

function exportCSV() {
    let csv = 'Date & Time,Systolic,Diastolic,Pulse\n';
    readings.forEach(r => {
        csv += `${r.datetime},${r.systolic},${r.diastolic},${r.pulse}\n`;
    });
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.setAttribute('href', url);
    a.setAttribute('download', 'bp_readings.csv');
    a.click();
}

updateTable();
updateChart();
</script>

</body>
</html>
